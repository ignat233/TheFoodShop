<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>
<head>
    <title>The Food Shop</title>
    <meta name="viewport" http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
<nav class="navbar navbar-expand-mb navbar-light bg-light sticky-top">
    <div class="container-fluid">
        <a href="/index" class="navbar-brad"><img style="width: 65px" src="https://png.pngtree.com/png-vector/20190618/ourlarge/pngtree-lunchdishspoonknife-abstract-flat-color-icon-template-png-image_1488580.jpg"></a>
    </div>
</nav>


<!--<div  class="carousel slide" data-ride="carousel" id="slides">-->
<!--    <ul class="carousel-indicators">-->
<!--        <li data-target="#slides" data-slide-to="0" class="active"></li>-->
<!--        <li data-target="#slides" data-slide-to="1" ></li>-->
<!--        <li data-target="#slides" data-slide-to="2" ></li>-->
<!--    </ul>-->
<!--    <div class="carousel-inner">-->
<!--        <div class="carousel-item active">-->
<!--&lt;!&ndash;            <img src="http://cdn.iz.ru/sites/default/files/styles/900x506/public/news-2021-04/pexels-pixabay-414630.jpeg.jpg?itok=f3Re-2vZ">&ndash;&gt;-->
<!--&lt;!&ndash;            <img src="https://robb.report/upload/custom/55c/55cfcf9a855633dd2469e566d4c37a29.jpg">&ndash;&gt;-->
<!--            <img src="https://store-images.s-microsoft.com/image/apps.64444.14416131676512756.a4895ce9-cd8d-4c80-a13c-dd63cf1980f1.4fa73540-3bb6-4190-b96c-fc69bf560940?mode=scale&q=90&h=720&w=1280">-->
<!--        </div>-->
<!--        <div class="carousel-item">-->
<!--&lt;!&ndash;            <img src="https://img.banket.ru/restaurants/restaurant_6558/gallery/fileec8a27cdf8cc9679a498051703e1b1e5.jpg">&ndash;&gt;-->
<!--            <img src="https://i.pinimg.com/originals/9f/66/0f/9f660f6d0d09d80f6cc039d275567deb.png">-->
<!--        </div>-->
<!--        <div class="carousel-item">-->
<!--&lt;!&ndash;            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR49Gmx7PmDxT5KEdWYYIuQkm807tYdPddq3Q&usqp=CAU">&ndash;&gt;-->
<!--&lt;!&ndash;            <img src="https://trattoria-rimini.ru/wp-content/uploads/2019/01/img_7083-2048x1365.jpg">&ndash;&gt;-->
<!--            <img src="https://steamuserimages-a.akamaihd.net/ugc/785230361343977676/CDDE77CB810474E1C07B945E40AE4713141AFD76/">-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->


<div class="container">
    <div class="row">
<div class="col-sm-3">
        <form action="/basket" method="get">
            <p><input type="submit"  value="Корзина"></p>
        </form>

</div>
    <div class="col-sm-6" ng-app ="indexApp" ng-controller="indexCtrl" >
        <h3>Меню</h3>
<table>
                <tr>
                    <th>Название</th>
                    <th>цена</th>
                    <th></th>
                    <th style="width: 45px">Кол.</th>
                    <th></th>
                    <th>Итог</th>
                </tr>

            <tr ng-repeat="x in products track by $index">
                <td>{{ x.name }}</td>
                <td>{{ x.price }}р.</td>
                <td><input type="button" ng-click="deleteInLocalStorage(x.id,x)"  ng-disabled="!dis(x)" value="-"></td>
                <td><input type="number" min="0" max="{{x.count}}"  data-ng-model="x.qty"  style="width: 45px" ></td>
                <td>  <input type="button" ng-click="putInLocalStorage(x.id,x,x.qty)" ng-disabled="dis(x)" value="+"></td>
                <td> {{total(x.qty,x.price)}}р.</td>
            </tr>
</table>
   </div>
    <div class="col-sm-3">
<div th:if="${param.error}">
    Invalid username and password.
</div>
<div th:if="${param.logout}">
    You have been logged out.
</div>
<div style="float:right; margin-right:10px;">
    <form th:action="@{/login}" method="get">
        <div><label> Login : <input type="text" name="username"> </label></div>
        <div><label> Password: <input type="password" name="password"> </label></div>
        <div><input type="submit" value="Войти"></div>
    </form>
    <a href="/register">Зарегистрироваться</a>
</div>
    </div>
</div>
</div>


    <script>
angular.module('indexApp', []).controller('indexCtrl',function($scope, $http) {




 $http({
    method : "GET",
      url : "/product"
  }).then(
            function(res) {
$scope.products = res.data;
            },
            function(res) {
                console.log("Error: " + res.status + " : " + res.data);
                }
  );
  $scope.putInLocalStorage = function(id,product,qtys) {
  if( !isNaN(qtys)){
  product['qty'] = qtys;
  localStorage.setItem(id,JSON.stringify(product));}
  }

 $scope.deleteInLocalStorage = function(id,product){
 localStorage.removeItem(id);
 }

 $scope.dis = function(prd){
               keys = Object.keys(localStorage);
            n = keys.length - 1;
        while(n>=0){
        if(JSON.parse(localStorage.getItem(keys[n])).id == prd.id){
return true;
        }
         n--;
         }
return false;
 }

 $scope.total = function(qty,price){
 if(isNaN(qty)) return 0;
 else return qty * price;
 }


});
</script>


</body>
</html>